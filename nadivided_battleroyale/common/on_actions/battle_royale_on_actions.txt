on_actions = {
	# triggers mod introduction and settings, event should be able to trigger self if loading mod in an existing save
	on_startup = {
		effect = {
			random_country = {
				country_event = battle_royale.1
			}
		}
	}
	#FROM is war target
	on_declare_war = {
		effect = {
			ROOT = {
				add_ai_strategy = {
					type = conquer
					id = FROM			
					value = 500
				}
				add_ai_strategy = {
					type = invade
					id = FROM			
					value = 500
				}
			}
			FROM = {
				add_ai_strategy = {
					type = conquer
					id = ROOT			
					value = 500
				}
				add_ai_strategy = {
					type = invade
					id = ROOT			
					value = 500
				}
			}
		}
	}
	# ensures countries cannot be released once battle royale starts by instantly having the releaser annex them
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					has_global_flag = battle_royale_started
					original_tag = FROM
				}
				set_country_flag = battle_royale_here_from_start
				add_named_threat = { threat = 100 name = battle_royale_participant }
			}
			if = {
				limit = {
					has_global_flag = battle_royale_started
					NOT = {original_tag = FROM}
					NOT = {has_country_flag = battle_royale_here_from_start}
				}
				if = {
					limit = {
						OR = {
							is_puppet = yes
							is_subject = yes
						}
					}
					OVERLORD = {
						end_puppet = PREV
					}
					set_autonomy = { # released countries get instantly annexed
						target = THIS
						autonomous_state = autonomy_free
					}
				}
				ROOT = {
					every_owned_state = {
						FROM = {transfer_state = PREV}
					}
				}
			}
		}
	}
	# removes annexed claims and cores once battle royale has started, needs special handling for dynamic country tags from civil wars
	on_annex = {
		effect = {
			if = {
				limit = { # by far the most common occurrence, just remove claims and cores of FROM
					has_global_flag = battle_royale_started
					NOT = {original_tag = FROM}
					FROM = {
						original_tag = FROM
					}
				}
				every_state = {
					limit = {
						is_claimed_by = FROM
					}
					remove_claim_by = FROM
				}
				every_state = {
					limit = {
						is_core_of = FROM
					}
					remove_core_of = FROM
				}
			}
			if = {
				limit = { # civil war revolter won their civil war, can't remove claims or cores of original yet, but save the original tag for later
					original_tag = FROM
				}
				set_country_flag = battle_royale_won_civil_war
				if = {
					limit = {
						tag = D01
					}
					FROM = {
						save_global_event_target_as = battle_royale_D01_original
					}
				}
				if = {
					limit = {
						tag = D02
					}
					FROM = {
						save_global_event_target_as = battle_royale_D02_original
					}
				}
				if = {
					limit = {
						tag = D03
					}
					FROM = {
						save_global_event_target_as = battle_royale_D03_original
					}
				}
				if = {
					limit = {
						tag = D04
					}
					FROM = {
						save_global_event_target_as = battle_royale_D04_original
					}
				}
				if = {
					limit = {
						tag = D05
					}
					FROM = {
						save_global_event_target_as = battle_royale_D05_original
					}
				}
				if = {
					limit = {
						tag = D06
					}
					FROM = {
						save_global_event_target_as = battle_royale_D06_original
					}
				}
				if = {
					limit = {
						tag = D07
					}
					FROM = {
						save_global_event_target_as = battle_royale_D07_original
					}
				}
				if = {
					limit = {
						tag = D08
					}
					FROM = {
						save_global_event_target_as = battle_royale_D08_original
					}
				}
				if = {
					limit = {
						tag = D09
					}
					FROM = {
						save_global_event_target_as = battle_royale_D09_original
					}
				}
				if = {
					limit = {
						tag = D10
					}
					FROM = {
						save_global_event_target_as = battle_royale_D10_original
					}
				}
				if = {
					limit = {
						tag = D11
					}
					FROM = {
						save_global_event_target_as = battle_royale_D11_original
					}
				}
				if = {
					limit = {
						tag = D12
					}
					FROM = {
						save_global_event_target_as = battle_royale_D12_original
					}
				}
				if = {
					limit = {
						tag = D13
					}
					FROM = {
						save_global_event_target_as = battle_royale_D13_original
					}
				}
				if = {
					limit = {
						tag = D14
					}
					FROM = {
						save_global_event_target_as = battle_royale_D14_original
					}
				}
				if = {
					limit = {
						tag = D15
					}
					FROM = {
						save_global_event_target_as = battle_royale_D15_original
					}
				}
			}
			if = {
				limit = { # civil war revolter was subsequently annexed, now pull up and remove claims and cores of original tag
					has_global_flag = battle_royale_started
					FROM = {
						has_country_flag = battle_royale_won_civil_war
					}
				}
				if = {
					limit = {
						FROM = {
							tag = D01
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D01_original
						}
						remove_claim_by = event_target:battle_royale_D01_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D01_original
						}
						remove_core_of = event_target:battle_royale_D01_original
					}
					clear_global_event_target = battle_royale_D01_original
				}
				if = {
					limit = {
						FROM = {
							tag = D02
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D02_original
						}
						remove_claim_by = event_target:battle_royale_D02_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D02_original
						}
						remove_core_of = event_target:battle_royale_D02_original
					}
					clear_global_event_target = battle_royale_D02_original
				}
				if = {
					limit = {
						FROM = {
							tag = D03
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D03_original
						}
						remove_claim_by = event_target:battle_royale_D03_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D03_original
						}
						remove_core_of = event_target:battle_royale_D03_original
					}
					clear_global_event_target = battle_royale_D03_original
				}
				if = {
					limit = {
						FROM = {
							tag = D04
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D04_original
						}
						remove_claim_by = event_target:battle_royale_D04_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D04_original
						}
						remove_core_of = event_target:battle_royale_D04_original
					}
					clear_global_event_target = battle_royale_D04_original
				}
				if = {
					limit = {
						FROM = {
							tag = D05
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D05_original
						}
						remove_claim_by = event_target:battle_royale_D05_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D05_original
						}
						remove_core_of = event_target:battle_royale_D05_original
					}
					clear_global_event_target = battle_royale_D05_original
				}
				if = {
					limit = {
						FROM = {
							tag = D06
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D06_original
						}
						remove_claim_by = event_target:battle_royale_D06_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D06_original
						}
						remove_core_of = event_target:battle_royale_D06_original
					}
					clear_global_event_target = battle_royale_D06_original
				}
				if = {
					limit = {
						FROM = {
							tag = D07
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D07_original
						}
						remove_claim_by = event_target:battle_royale_D07_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D07_original
						}
						remove_core_of = event_target:battle_royale_D07_original
					}
					clear_global_event_target = battle_royale_D07_original
				}
				if = {
					limit = {
						FROM = {
							tag = D08
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D08_original
						}
						remove_claim_by = event_target:battle_royale_D08_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D08_original
						}
						remove_core_of = event_target:battle_royale_D08_original
					}
					clear_global_event_target = battle_royale_D08_original
				}
				if = {
					limit = {
						FROM = {
							tag = D09
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D09_original
						}
						remove_claim_by = event_target:battle_royale_D09_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D09_original
						}
						remove_core_of = event_target:battle_royale_D09_original
					}
					clear_global_event_target = battle_royale_D09_original
				}
				if = {
					limit = {
						FROM = {
							tag = D10
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D10_original
						}
						remove_claim_by = event_target:battle_royale_D10_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D10_original
						}
						remove_core_of = event_target:battle_royale_D10_original
					}
					clear_global_event_target = battle_royale_D10_original
				}
				if = {
					limit = {
						FROM = {
							tag = D11
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D11_original
						}
						remove_claim_by = event_target:battle_royale_D11_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D11_original
						}
						remove_core_of = event_target:battle_royale_D11_original
					}
					clear_global_event_target = battle_royale_D11_original
				}
				if = {
					limit = {
						FROM = {
							tag = D12
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D12_original
						}
						remove_claim_by = event_target:battle_royale_D12_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D12_original
						}
						remove_core_of = event_target:battle_royale_D12_original
					}
					clear_global_event_target = battle_royale_D12_original
				}
				if = {
					limit = {
						FROM = {
							tag = D13
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D13_original
						}
						remove_claim_by = event_target:battle_royale_D13_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D13_original
						}
						remove_core_of = event_target:battle_royale_D13_original
					}
					clear_global_event_target = battle_royale_D13_original
				}
				if = {
					limit = {
						FROM = {
							tag = D14
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D14_original
						}
						remove_claim_by = event_target:battle_royale_D14_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D14_original
						}
						remove_core_of = event_target:battle_royale_D14_original
					}
					clear_global_event_target = battle_royale_D14_original
				}
				if = {
					limit = {
						FROM = {
							tag = D15
						}
					}
					every_state = {
						limit = {
							is_claimed_by = event_target:battle_royale_D15_original
						}
						remove_claim_by = event_target:battle_royale_D15_original
					}
					every_state = {
						limit = {
							is_core_of = event_target:battle_royale_D15_original
						}
						remove_core_of = event_target:battle_royale_D15_original
					}
					clear_global_event_target = battle_royale_D15_original
				}
			}
		}
	}
}
